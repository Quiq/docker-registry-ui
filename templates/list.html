{{extends "base.html"}}

{{block head()}}
<script type="text/javascript" src="{{ basePath }}/static/bootstrap-confirmation.min.js"></script>
<script type="text/javascript" src="{{ basePath }}/static/sorting_natural.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $('#datatable').DataTable({
            "pageLength": 25,
            "order": [[ 0, 'desc' ]],
            "stateSave": true,
            columnDefs: [
              { data: 'Type', visible: false, targets: 2 },
              { type: 'natural', targets: 0, width: "80%" }
            ],
            "language": {
                "emptyTable": "No entry."
            },
            rowGroup: {
                dataSrc: 'Type'
            }
        })
        function populateConfirmation()  {
            $('[data-toggle=confirmation]').confirmation({
                rootSelector: '[data-toggle=confirmation]',
                container: 'body'
            });
        }
        populateConfirmation()
        $('#datatable').on('draw.dt', populateConfirmation)

    });
</script>
{{end}}

{{block body()}}
<ol class="breadcrumb">
    <li><a href="{{ basePath }}/">{{ registryHost }}</a></li>
    {{range crumb := breadCrumbs}}
    <li><a href="{{ basePath }}/{{ crumb.path }}">{{ crumb.segment }}</a></li>
    {{end}}
</ol>

<table id="datatable" class="table table-striped table-bordered">
    <thead bgcolor="#ddd">
        <tr>
            <th>Name</th>
            <th>Tag count</th>
            <th>Type</th>
        </tr>
    </thead>
    <tbody>
        {{range tag := tags}}
        <tr>
            <td>
                <a href="{{ basePath }}/{{ repoPath }}/manifests/{{ tag }}">{{ tag }}</a>
                {{if deleteAllowed}}
                <a href="{{ basePath }}/{{ repoPath }}/manifests/{{ tag }}/delete" data-toggle="confirmation" class="btn btn-danger btn-xs pull-right" role="button">Delete</a>
                {{end}}
            </td>
            <td>n/a</td>
            <td>Tags</td>
        </tr>
        {{end}}
        {{range repo := repos}}
        <tr>
            <td>
                {{noprefix_repo := repo[len(repoPath):]}}
                {{if noprefix_repo[0:1] == "/"}}
                {{noprefix_repo = noprefix_repo[1:]}}
                {{end}}
                <a href="{{ basePath }}/{{ repo }}">{{ noprefix_repo }}</a>
            </td>
            <td>{{ tagCounts[repo] }}</td>
            <td>Repositories</td>
        </tr>
        {{end}}
    </tbody>
</table>

<h4>Latest events on this repo</h4>
<table id="datatable_log" class="table table-striped table-bordered">
    <thead bgcolor="#ddd">
        <tr>
            <th>Action</th>
            <th>Image</th>
            <th>IP Address</th>
            <th>User</th>
            <th>Time</th>
        </tr>
    </thead>
    <tbody>
        {{range e := events}}
            <tr>
                <td>{{ e.Action }}</td>
                {{if hasPrefix(e.Tag,"sha256") }}
                <td title="{{ e.Tag }}">{{ e.Repository }}@{{ e.Tag[:19] }}...</td>
                {{else}}
                <td>{{ e.Repository }}:{{ e.Tag }}</td>
                {{end}}
                <td>{{ e.IP }}</td>
                <td>{{ e.User }}</td>
                <td>{{ e.Created|pretty_time }}</td>
            </tr>
        {{end}}
    </tbody>
</table>

{{end}}
